<!doctype html>
<html lang="fr">
  <%- include('partials/head', { title: title }) %>
  <% include partials/header %>
  <body>
    <main>
      <h1>Gestion des utilisateurs</h1>

      <section class="stack">
        <h2><%= editUser ? 'Éditer utilisateur' : 'Créer utilisateur' %></h2>
        <form class="form" method="post" action="<%= editUser ? ('/api/users/' + editUser.id) : '/api/users' %>">
          <% if (editUser) { %>
            <input type="hidden" name="id" value="<%= editUser.id %>" />
            <input type="hidden" name="_method" value="PUT" />
          <% } %>
          <label>Email <input name="email" type="email" required value="<%= editUser ? editUser.email : '' %>" /></label>
          <label>Nom <input name="name" value="<%= editUser ? editUser.name : '' %>" /></label>
          <label>Password <input name="password" type="password" value="" placeholder="<%= editUser ? 'Laisser vide pour ne pas changer' : '' %>" /></label>
          <div class="row">
            <button type="submit">Enregistrer</button>
            <a href="/users">Annuler</a>
          </div>
        </form>
      </section>

      <section class="stack">
        <h2>Liste des utilisateurs</h2>
        <table class="table">
          <thead>
            <tr>
                <th>ID</th>
                <th>Email</th>
                <th>Nom</th>
                <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% (users||[]).forEach(function(u){ %>
              <tr>
                <td><%= u.id %></td>
                <td><%= u.email || '' %></td>
                <td><%= u.name || '' %></td>
                <td>
                  <a href="/users?edit=<%= u.id %>">Éditer</a>
                  <form method="post" action="/api/users/<%= u.id %>" style="display:inline" onsubmit="return confirm('Supprimer cet utilisateur ?');">
                    <input type="hidden" name="_method" value="DELETE" />
                    <button type="submit">Supprimer</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </section>

    </main>
    <% include partials/footer %>
  </body>
</html>
